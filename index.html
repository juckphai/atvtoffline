<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô">
  <link rel="apple-touch-icon" href="./192.png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="style.css">
  
  <style>
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤ */
    .logout-btn {
      background-color: #dc3545 !important;
      border: 3px solid #ffffff !important;
    }
    .logout-btn:hover {
      background-color: #c82333 !important;
    }
  </style>
</head>
<body>

  <div id="login-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;">
    <div style="background: white; padding: 30px 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 350px; text-align: center;">
        <h2 style="color: #4a90e2; margin-bottom: 20px; font-family: sans-serif;">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Offline)</h2>
        
        <input type="text" id="loginEmail" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥)" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px;">
        
        <div style="display:none;">
            <input type="password" id="loginPassword" value="123456">
        </div>

        <button onclick="localLogin()" style="width: 100%; padding: 12px; background-color: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        
        <p id="loginError" style="color: #dc3545; font-size: 14px; margin-top: 15px; min-height: 20px;"></p>
    </div>
    <p style="margin-top: 20px; color: #888; font-size: 0.8rem;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (Offline Support)</p>
  </div>

  <div class="container" style="padding:0; border:none; background:none;">
    
    <div id="install-guide" class="install-prompt">
      <span class="close-prompt" onclick="hideInstallPromptPermanently()">&times;</span>
      <h4>üì± ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</h4>
      <ul>
        <li><b>üì± ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Android:</b> ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå Chrome ‡∏à‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ" ‡∏´‡∏£‡∏∑‡∏≠ "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å" ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏î</li>
        <li><b>üì± ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iPhone (iOS):</b> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Safari ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏ä‡∏£‡πå" (Share) ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°" (Add to Home Screen)</li>
      </ul>
      <div style="text-align: center; margin-top: 2px;">
        <button onclick="hideInstallPromptPermanently()" style="background-color: #6c757d; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">
          ‚ùå ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å
        </button>
      </div>
    </div>

    <div style="text-align: center; margin-top: 2px;">
      <div class="container">
        <div style="width: 100%; max-width: 900px; margin: 10px auto;">
       
          <div id="user-status-bar" style="display:none; background-color: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 15px; border: 1px solid #90caf9; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <span style="font-weight: normal;">üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</span> 
              <span id="current-user-display" style="font-weight: bold; margin-left: 5px;">-</span>
          </div>
          
          <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0;">
            <div style="display: flex; justify-content: center; align-items: center; flex-direction: row; gap: 10px; padding: 0 5px; width: 100%;">
              
              <button 
                type="button" 
                onclick="document.getElementById('restoreFile').click()" 
                style="
                  background-color: #4a90e2;
                  color: white;
                  font-weight: bold;
                  padding: 8px 15px;
                  height: 40px;
                  font-size: 0.9rem;
                  border: 3px solid #546de5;
                  border-radius: 50px;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  white-space: nowrap;
                  width: auto;
                  min-width: 110px;
                  margin-top: 0;
                  touch-action: manipulation;
                "
                onmouseover="this.style.backgroundColor='#3a7ed9'"
                onmouseout="this.style.backgroundColor='#4a90e2'">
                üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>

              <button 
                id="btnLogout" 
                onclick="localLogout()" 
                class="logout-btn"
                style="
                  color: white;
                  font-weight: bold;
                  padding: 8px 15px;
                  height: 40px;
                  font-size: 0.9rem;
                  border-radius: 50px;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  white-space: nowrap;
                  width: auto;
                  min-width: 110px;
                  margin-top: 0;
                  touch-action: manipulation;
                  display: none;
                ">
                üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
              </button>

              <input 
                type="file" 
                id="restoreFile" 
                accept=".json" 
                style="display: none;" 
                onchange="restoreData(this.files[0])">
            </div>
          </div>

          <div class="section-header main-section-header header-add-data" onclick="toggleMainSection('add-activity-section')">
            <span>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
            <span class="menu-icon">‚ñº</span>
          </div>
          <div id="add-activity-section" class="section-content main-section-content">
             <div class="form-section no-border">
                <form id="activity-form">
                  <div class="management-row compact-layout">
                    <div class="management-container full-width">
                      <div class="select-wrapper" style="display: flex; align-items: center; gap: 6px; width: 100%;">
                        <button type="button" class="manage-btn-inline" id="togglePersonControls" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏ö‡∏≠‡∏Å" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚öôÔ∏è</button>
                        <select id="personSelect" required style="flex: 1; font-size: 14px; padding: 6px 10px; border-radius: 6px; height: 34px; background-color: #fff;">
                          <option value="">üë§ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                        </select>
                      </div>
                      <div class="management-actions" id="personActions" style="display: none;">
                        <button type="button" id="addPersonBtn" class="add-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        <button type="button" id="editPersonBtn" class="edit-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button type="button" id="deletePersonBtn" class="delete-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">üóëÔ∏è ‡∏•‡∏ö</button>
                        <button type="button" id="resetPersonBtn" class="reset-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤</button>
                      </div>
                    </div>
  
                    <div class="management-container full-width">
                      <div class="select-wrapper" style="display: flex; align-items: center; gap: 6px; width: 100%;">
                        <button type="button" class="manage-btn-inline" id="toggleActivityTypeControls" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚öôÔ∏è</button>
                        <select id="activityTypeSelect" required style="flex: 1; font-size: 14px; padding: 6px 10px; border-radius: 6px; height: 34px; background-color: #fff;">
                          <option value="">üìä ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                        </select>
                      </div>
                      <div class="management-actions" id="activityTypeActions" style="display: none;">
                        <button type="button" id="addActivityTypeBtn" class="add-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        <button type="button" id="editActivityTypeBtn" class="edit-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button type="button" id="deleteActivityTypeBtn" class="delete-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">üóëÔ∏è ‡∏•‡∏ö</button>
                        <button type="button" id="resetActivityTypeBtn" class="reset-btn" style="font-size: clamp(0.5rem, 2.5vw, 1rem);">üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤</button>
                      </div>
                    </div>
                  </div>
                  
                  <div class="date-wrapper" style="display: flex; justify-content: center; align-items: center; margin-bottom: 2px; width: 100%;">
                    <label for="activity-date" style="margin-right: 4px; font-size: clamp(0.8rem, 2.5vw, 1rem); white-space: nowrap;">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà : </label>
                    <input type="date" id="activity-date" style="font-size: clamp(0.8rem, 2.5vw, 1rem); padding: 4px; max-width: 250px; width: 60%; background-color: #fff;">
                  </div>
  
                  <div class="time-inputs-section">
                    <div class="time-input-group duration-block" style="width: 100%; max-width: 400px; margin: 0 auto;">
                      <div class="date-wrapper duration-wrapper" style="display: flex; justify-content: center; align-items: center; width: 100%; margin-bottom: 2px;">
                        <label class="display-date" style="font-size: clamp(0.8rem, 2.5vw, 1rem); white-space: nowrap; font-weight: normal; color: #000; margin: 0 auto; text-align: center;">‚è±Ô∏è ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ :</label>
                      </div>
                      <div class="duration-inputs-container" style="display: flex; justify-content: center; align-items: center; gap: 10px; width: 100%; margin-top: 5px;"> 
                        <div class="duration-input-group" style="flex: 0 0 auto;">
                          <input type="number" id="duration-hours" min="0" max="23" value="1" placeholder="‡∏ä‡∏°." required style="width: 70px; padding: 6px; text-align: center; font-size: clamp(0.8rem, 2.5vw, 1rem); border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; background-color: #fff;">
                          <span class="duration-label" style="font-size: 0.8rem; margin-top: 4px;">üïê ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
                        </div>
                        <div class="duration-input-group" style="flex: 0 0 auto;">
                          <input type="number" id="duration-minutes" min="0" max="59" value="0" placeholder="‡∏ô." required style="width: 70px; padding: 6px; text-align: center; font-size: clamp(0.8rem, 2.5vw, 1rem); border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; background-color: #fff;">
                          <span class="duration-label" style="font-size: 0.8rem; margin-top: 4px;">‚è∞ ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                        </div>
                      </div>
                    </div>
  
                    <div class="time-row" style="display: flex; justify-content: center; gap: 4px; margin-top: 2px;">
                      <div class="time-input-group">
                        <div class="date-wrapper">
                          <input type="time" id="start-time" readonly style="background-color: #f0f0f0;">
                          <label for="start-time" class="time-label-bottom" style="margin-top: 2px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        </div>
                      </div>
                      <div class="time-input-group">
                        <div class="date-wrapper">
                          <input type="time" id="end-time" required style="background-color: #fff;">
                          <label for="end-time" class="time-label-bottom" style="margin-top: 2px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        </div>
                      </div>
                    </div>
                  </div>
  
                  <div style="display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 2px;">
                    <label for="activity-details" style="text-align: center; width: 100%; margin-bottom: 2px;">üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</label>
                    <textarea id="activity-details" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°, ‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5" style="width: 100%; max-width: 500px; margin: 0 auto; display: block; padding: 6px; background-color: #fff;"></textarea>
                  </div>
                  
                  <div class="center" style="margin-top: 2px;">
                    <button id="save-activity-button" class="main-button">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
                  </div>
  
                  <div class="button-container" style="margin-top: 2px;">
                    <button type="button" class="main-button" onclick="toggleActivitiesVisibility()">üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                  </div>
  
                  <button type="button" id="update-activity-button" class="hidden">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
                  <button type="button" id="cancel-edit-activity-button" class="hidden">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                  
                  <p id="activity-message" class="error-message" style="margin-top: 2px;"></p>
                </form>
             </div>
          </div>
          <div class="section-header main-section-header header-actions" onclick="toggleMainSection('manage-activities-section')">
            <span>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
            <span class="menu-icon">‚ñº</span>
          </div>
          <div id="manage-activities-section" class="section-content main-section-content">
             <div class="form-section no-border">
               <form id="manage-activities-form">
                 <div style="text-align: center; margin: 2px 0;">
                   <p id="password-status" style="margin: 2px 0; font-size: clamp(0.7rem, 1.5vw, 1rem); color: #f5a623;">
                     üîí ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                   </p>
                 </div>
 
                 <div style="display: flex; justify-content: center; gap: 8px; margin: 4px 0;">
                   <button type="button" onclick="saveToLocal()" style="width: 160px; border-radius: 30px; background-color: #546de5; padding: 8px;" onmouseover="this.style.backgroundColor='#435cb7'" onmouseout="this.style.backgroundColor='#546de5'">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
                   <button type="button" onclick="openExportOptionsModal()" style="width: 160px; border-radius: 30px; background-color: #1dd1a1; padding: 8px;" onmouseover="this.style.backgroundColor='#18a381'" onmouseout="this.style.backgroundColor='#1dd1a1'">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                 </div>
 
                 <div class="entry-group" style="font-size: clamp(0.8rem, 2.5vw, 1rem); margin-top: 2px;">
                   <label for="backup-password">üîê ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</label>
                   <div style="position: relative; margin-top: 2px;">
                     <input type="password" id="backup-password" placeholder="‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ" style="width: 100%; padding-right: 40px; padding: 8px; font-size: clamp(0.5rem, 2.5vw, 1.2rem); border-radius: 8px; background-color: #fff;">
                     <span id="toggle-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none; font-size: clamp(0.8rem, 2.5vw, 1rem);">üëÅÔ∏è</span>
                   </div>
                 </div>
 
                 <div class="entry-group" style="margin-top: 2px;">
                   <label for="backup-password-confirm">üîê ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</label>
                   <div style="position: relative; margin-top: 2px;">
                     <input type="password" id="backup-password-confirm" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" style="width: 100%; padding-right: 40px; padding: 8px; font-size: clamp(0.5rem, 2.5vw, 1.2rem); border-radius: 8px; background-color: #fff;">
                     <span id="toggle-password-confirm" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none;">üëÅÔ∏è</span>
                   </div>
                 </div>
 
                 <div style="display: flex; justify-content: center; gap: 8px; margin-top: 2px;">
                   <button type="button" onclick="saveBackupPassword(event)" style="width: 160px; border-radius: 30px; background-color: #f39c12; padding: 8px;" onmouseover="this.style.backgroundColor='#d35400'" onmouseout="this.style.backgroundColor='#f39c12'">üîí ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
                   <button type="button" onclick="clearBackupPassword()" style="width: 160px; border-radius: 30px; background-color: #ff7f50; padding: 8px;" onmouseover="this.style.backgroundColor='#ff6347'" onmouseout="this.style.backgroundColor='#ff7f50'">‚ùå ‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
                 </div>
 
                 <div class="summary-subsection" style="margin-top: 2px;">
                   <div style="display: flex; justify-content: center; margin-bottom: 2px;">
                     <button type="button" onclick="cleanAllData()" class="clean-data-btn" style="background-color: #dc3545; border-radius: 30px; color: white; padding: 8px 18px;" onmouseover="this.style.backgroundColor='#c82333'" onmouseout="this.style.backgroundColor='#dc3545'">üßπ ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                   </div>
                   <p style="text-align: center; font-size: 0.85rem; color: #666; margin-top: 2px;">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥, ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏¢‡∏∞ ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</p>
                 </div>
               </form>
             </div>
          </div>

          <div class="section-header main-section-header header-summary" onclick="toggleMainSection('summary-section')">
            <span>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
            <span class="menu-icon">‚ñº</span>
          </div>
          <div id="summary-section" class="section-content main-section-content">
             <div class="form-section no-border">
                <form id="summary-form">
                  <div class="entry-form" style="margin-bottom: 2;">
                    <div class="entry-group">
                      <label for="summary-type-select">üìà ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ:</label>
                      <select id="summary-type-select" onchange="loadSummaryData()" style="background-color: #fff;">
                        <option value="brief-summary">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠</option>
                        <option value="single-day">üìÖ ‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                        <option value="date-range">üìÜ ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</option>
                        <option value="all-time">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                      </select>
                    </div>
                  </div>
  
                  <div class="summary-controls">
                    <div class="auto-selected-person" id="autoSelectedPerson" style="display: none; background-color: #f8f9fa; padding: 8px 12px; border-radius: 15px; border: 1px solid #dee2e6; margin-bottom: 2px; text-align: center;">
                      <label style="font-weight: bold; margin-right: 8px; color: #495057; display: inline-block; width: auto; margin-bottom: 0;">üë§ ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</label>
                      <span id="selectedPersonName" style="color: #28a745; font-size: 1rem; font-weight: bold;"></span>
                    </div>
  
                    <div class="person-filter-container" id="personFilterContainer">
                      <label for="personFilter">üë§ ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</label>
                      <select id="personFilter" onchange="loadSummaryData()" style="background-color: #fff;">
                        <option value="all">üë• ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô</option>
                      </select>
                    </div>
                  </div>
                  
                  <div id="summary-date-picker" class="summary-subsection hidden">
                    <label class="summary-subsection-header">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <div class="summary-date-display">
                      <div class="date-label">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</div>
                      <input type="date" id="summary-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px; background-color: #fff;">
                    </div>
                  </div>
  
                  <div id="summary-date-range" class="summary-subsection hidden">
                    <label class="summary-subsection-header">üìÜ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <div class="summary-date-display">
                      <div class="date-label">üìÖ ‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</div>
                      <input type="date" id="summary-start-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px; background-color: #fff;">
                    </div>
                    <div class="summary-date-display">
                      <div class="date-label">üìÖ ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</div>
                      <input type="date" id="summary-end-date" style="width: 100%; max-width: 200px; padding: 8px; font-size: 14px; background-color: #fff;">
                    </div>
                  </div>
                  
                  <div class="summary-subsection">
                    <div class="button-container" style="text-align: center; margin-top: 2px;">
                      <button type="button" onclick="viewSummary()" style="display: inline-block; background-color: #7d5fff; color: #fff; border: 2px solid #546de5; border-radius: 30px; padding: 5px 15px; font-size: 16px; font-weight: 500; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2); transition: all 0.25s ease; width: auto; min-width: fit-content;" onmouseover="this.style.transform='scale(1.05)'; this.style.backgroundColor='#5f44d9';" onmouseout="this.style.transform='scale(1)'; this.style.backgroundColor='#7d5fff';">üìä ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ</button>
                    </div>
                  </div>
                </form>
             </div>
          </div>
        </div>    
      </div>   
    </div>

    <div id="activitiesSection" style="display: none; margin-top: 2px; width: 100%;">
      <div class="table-container">
        <table id="activityTable">
          <thead>
            <tr>
              <th>üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ</th>
              <th>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
              <th>üë§ ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
              <th>üìä ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
              <th>‚è±Ô∏è ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th>üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
              <th>üîß ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="activityBody"></tbody>
        </table>
      </div>
    </div>

    <div id="summaryModal" class="modal-overlay">
      <div class="modal-content-container">
        <div id="modalBodyContent" class="summaryResult"></div>
        <div class="modal-controls">
          <button id="saveSummaryAsImageBtn" class="modal-control-btn">üñºÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
          <button type="button" onclick="closeSummaryModal()" class="modal-close-btn modal-control-btn">‚ùå ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</button>
        </div>
      </div>
    </div>

    <div id="summaryOutputModal" class="modal-overlay">
      <div class="format-modal-content">
        <h3>üìä ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ</h3>
        <div class="format-modal-buttons">
          <button type="button" class="btn-display" onclick="handleSummaryOutput('display')">üì∫ ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏à‡∏≠</button>
          <button type="button" class="btn-xlsx" onclick="handleSummaryOutput('xlsx')">üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô XLSX</button>
          <button type="button" class="btn-pdf" onclick="handleSummaryOutput('pdf')">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
          <button type="button" class="btn-cancel" onclick="closeSummaryOutputModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <div id="personModal" class="popup-overlay">
      <div class="popup-content" style="max-width: 600px; background-color: #f0f8ff;">
        <h2 id="personModalTitle" style="color: #0056b3; text-align: center;"></h2>
        <input type="hidden" id="personEditValue">
        <input type="text" id="modalPersonName" placeholder="üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" style="background-color: #fff;">
        <div class="modal-button-group">
          <button type="button" id="savePersonBtn" style="background-color: #28a745;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" id="cancelPersonBtn" class="close-popup-btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <div id="activityTypeModal" class="popup-overlay">
      <div class="popup-content" style="max-width: 600px; background-color: #f0f8ff;">
        <h2 id="activityTypeModalTitle" style="color: #0056b3; text-align: center;"></h2>
        <input type="hidden" id="activityTypeEditValue">
        <input type="text" id="modalActivityTypeName" placeholder="üìä ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" style="background-color: #fff;">
        <div class="modal-button-group">
          <button type="button" id="saveActivityTypeBtn" style="background-color: #28a745;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" id="cancelActivityTypeBtn" class="close-popup-btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <div id="changePasswordModal" class="modal-overlay" style="display:none;">
      </div>

    <div id="print-container" style="display: none;"></div>
    <div id="toast" class="toast-notification" style="display: none;"></div>

    <div id="exportOptionsModal" class="modal-overlay">
      <div class="format-modal-content">
        <h3>üíæ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
        <div class="format-modal-buttons">
          <button onclick="saveToFile()" style="background-color: #0d47a1;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button class="btn-cancel" onclick="closeExportOptionsModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <div id="singleDateExportModal" class="modal-overlay">
       </div>

    <footer style="text-align: center; padding: 5px; color: #888; font-size: 0.8rem; margin-top: 5px; background-color: #FAFAD2;">
        &copy; 140169 juckphai ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°. All Rights Reserved. (Offline Version)
    </footer>

  <script src="indexeddb-adapter.js"></script>

  <script src="script.js"></script>

  <script>
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Login/Logout ‡πÅ‡∏ö‡∏ö Local Simulation
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.addEventListener('load', () => {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            const userObj = JSON.parse(savedUser);
            simulateLoginSuccess(userObj);
        } else {
            document.getElementById('login-overlay').style.display = 'flex';
        }
        
        // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
            .then(reg => console.log('SW Registered'))
            .catch(err => console.log('SW Fail', err));
        }
    });

    function localLogin() {
        const email = document.getElementById('loginEmail').value.trim();
        if (!email) {
            document.getElementById('loginError').textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            return;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á User Object ‡∏à‡∏≥‡∏•‡∏≠‡∏á
        const userObj = {
            email: email,
            uid: 'offline-' + new Date().getTime()
        };
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Session
        localStorage.setItem('currentUser', JSON.stringify(userObj));
        
        simulateLoginSuccess(userObj);
    }
    
    function simulateLoginSuccess(user) {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('btnLogout').style.display = 'inline-block';
        
        const userStatusBar = document.getElementById('user-status-bar');
        const userDisplaySpan = document.getElementById('current-user-display');
        
        if (userStatusBar && userDisplaySpan) {
            userStatusBar.style.display = 'block';
            userDisplaySpan.textContent = user.email;
        }
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å function ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô script.js
        if (typeof initOfflineData === 'function') {
            initOfflineData(user);
        }
    }

    function localLogout() {
        if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
            localStorage.removeItem('currentUser');
            window.location.reload();
        }
    }
    
    function toggleLoginPassword() {
        // ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô Offline Mode ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡∏±‡∏ô Error
    }
  </script>
</body>
</html>